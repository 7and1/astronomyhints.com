@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html {
    @apply h-full;
  }

  body {
    @apply min-h-full bg-black text-white;
    text-rendering: optimizeLegibility;
  }

  ::selection {
    background: rgba(34, 211, 238, 0.25);
  }
}

@layer components {
  /* Screen reader only - visually hidden but accessible */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  /* Skip to content link */
  .skip-link {
    @apply fixed top-0 left-0 z-[100] bg-cyan-600 text-white px-4 py-3 font-semibold;
    transform: translateY(-100%);
    transition: transform 0.2s ease-in-out;
  }

  .skip-link:focus {
    transform: translateY(0);
    outline: 3px solid white;
    outline-offset: 2px;
  }

  /* High contrast mode support */
  @media (prefers-contrast: more) {
    .ui-panel {
      @apply border-white/40;
    }
    .ui-btn,
    .ui-icon-btn {
      @apply border-white/50;
    }
  }

  /* Focus visible improvements for all interactive elements */
  :focus-visible {
    outline: 2px solid rgb(34 211 238 / 0.8);
    outline-offset: 2px;
  }

  /* Ensure minimum touch target size (44x44px) */
  .touch-target {
    min-width: 44px;
    min-height: 44px;
  }

  .ui-panel {
    @apply bg-black/55 backdrop-blur-md border border-white/10 rounded-xl;
    box-shadow:
      0 0 0 1px rgba(255, 255, 255, 0.04),
      0 24px 80px -40px rgba(0, 0, 0, 0.85);
  }

  .ui-panel-strong {
    @apply bg-black/75 border-white/15;
  }

  .ui-divider {
    @apply h-px bg-white/10;
  }

  .ui-icon-btn {
    @apply inline-flex items-center justify-center size-10 rounded-lg border border-white/10 bg-white/5 text-white/80;
    @apply hover:bg-white/10 hover:text-white hover:border-white/20;
    @apply active:scale-95;
    @apply disabled:cursor-not-allowed disabled:opacity-50 disabled:hover:bg-white/5 disabled:hover:border-white/10 disabled:active:scale-100;
    @apply focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/60 focus-visible:ring-offset-2 focus-visible:ring-offset-black;
  }

  .ui-icon-btn[data-active='true'] {
    @apply bg-cyan-500/20 border-cyan-400/40 text-cyan-200;
  }

  .ui-icon-btn[data-danger='true'][data-active='true'] {
    @apply bg-rose-500/20 border-rose-400/40 text-rose-200;
  }

  .ui-btn {
    @apply inline-flex items-center justify-center gap-2 rounded-lg border border-white/10 bg-white/5 px-4 py-2 text-sm font-medium text-white/90;
    @apply hover:bg-white/10 hover:border-white/20;
    @apply active:scale-[0.98];
    @apply disabled:cursor-not-allowed disabled:opacity-50 disabled:hover:bg-white/5 disabled:hover:border-white/10 disabled:active:scale-100;
    @apply focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/60 focus-visible:ring-offset-2 focus-visible:ring-offset-black;
  }

  .ui-btn-primary {
    @apply bg-cyan-500/25 border-cyan-400/40 hover:bg-cyan-500/30;
  }

  .ui-btn[data-active='true'] {
    @apply bg-cyan-500/15 border-cyan-400/30;
  }

  .ui-btn[data-danger='true'][data-active='true'] {
    @apply bg-rose-500/15 border-rose-400/30 text-rose-100;
  }

  .ui-kbd {
    @apply rounded-md border border-white/10 bg-white/5 px-2 py-1 font-mono text-[11px] text-white/70;
  }

  .ui-chip {
    @apply inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs text-white/70;
  }

  .ui-link {
    @apply text-cyan-200 underline decoration-cyan-400/40 underline-offset-4;
    @apply hover:text-cyan-100 hover:decoration-cyan-400/70;
  }
}

@layer utilities {
  .text-glow {
    text-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
  }
  
  .border-glow {
    box-shadow: 0 0 10px currentColor;
  }

  .hud-backdrop {
    animation: hud-backdrop-in 150ms ease-out both;
  }

  .hud-dialog {
    animation: hud-dialog-in 180ms cubic-bezier(0.16, 1, 0.3, 1) both;
  }

  .hud-toast {
    animation: hud-toast-in 160ms cubic-bezier(0.16, 1, 0.3, 1) both;
  }
}

@keyframes hud-backdrop-in {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes hud-dialog-in {
  from {
    opacity: 0;
    transform: translate3d(0, 8px, 0) scale(0.99);
  }
  to {
    opacity: 1;
    transform: translate3d(0, 0, 0) scale(1);
  }
}

@keyframes hud-toast-in {
  from {
    opacity: 0;
    transform: translate3d(0, 10px, 0);
  }
  to {
    opacity: 1;
    transform: translate3d(0, 0, 0);
  }
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.3);
}

::-webkit-scrollbar-thumb {
  background: rgba(6, 182, 212, 0.5);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(6, 182, 212, 0.7);
}

/* Smooth transitions */
button,
a {
  transition-property: color, background-color, border-color, text-decoration-color, opacity, box-shadow, transform;
  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  transition-duration: 150ms;
}

/* Disable transitions for canvas */
canvas {
  transition: none !important;
}

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0ms !important;
    scroll-behavior: auto !important;
  }
}

/* ============================================
   MOBILE OPTIMIZATIONS
   ============================================ */

/* Prevent pull-to-refresh on mobile */
html {
  overscroll-behavior-y: contain;
}

/* Prevent text selection on interactive elements */
.no-select {
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
}

/* Touch action utilities */
.touch-none {
  touch-action: none;
}

.touch-pan-x {
  touch-action: pan-x;
}

.touch-pan-y {
  touch-action: pan-y;
}

.touch-manipulation {
  touch-action: manipulation;
}

/* Mobile-specific button sizes (44x44px minimum touch target) */
@media (pointer: coarse) {
  .ui-icon-btn {
    @apply size-11;
  }

  .ui-btn {
    @apply min-h-[44px] px-4 py-3;
  }

  /* Increase spacing between interactive elements */
  .ui-panel .flex.gap-2 {
    gap: 0.75rem;
  }

  /* Larger text for mobile readability */
  .ui-panel .text-xs {
    font-size: 0.8125rem;
  }

  .ui-panel .text-sm {
    font-size: 0.9375rem;
  }
}

/* Safe area insets for notched devices */
@supports (padding: env(safe-area-inset-top)) {
  .safe-area-top {
    padding-top: env(safe-area-inset-top);
  }

  .safe-area-bottom {
    padding-bottom: env(safe-area-inset-bottom);
  }

  .safe-area-left {
    padding-left: env(safe-area-inset-left);
  }

  .safe-area-right {
    padding-right: env(safe-area-inset-right);
  }

  .safe-area-inset {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }

  /* Adjust fixed bottom elements for safe area */
  .fixed.bottom-4 {
    bottom: max(1rem, env(safe-area-inset-bottom));
  }

  .fixed.bottom-6 {
    bottom: max(1.5rem, env(safe-area-inset-bottom));
  }
}

/* PWA standalone mode adjustments */
@media (display-mode: standalone) {
  /* Hide browser-specific UI elements */
  .browser-only {
    display: none !important;
  }

  /* Adjust top padding for status bar */
  .fixed.top-0 {
    padding-top: env(safe-area-inset-top, 0);
  }
}

/* Landscape mobile optimizations */
@media (max-height: 500px) and (orientation: landscape) {
  .ui-panel {
    @apply p-2;
  }

  .ui-panel .text-2xl {
    @apply text-lg;
  }

  /* Compact time panel in landscape */
  .fixed.bottom-4.left-4 .ui-panel {
    @apply p-3;
  }

  /* Hide non-essential elements in landscape */
  .landscape-hide {
    display: none !important;
  }
}

/* Small mobile screens */
@media (max-width: 374px) {
  .ui-panel {
    @apply p-3;
  }

  .ui-icon-btn {
    @apply size-9;
  }

  .text-2xl {
    @apply text-xl;
  }
}

/* Touch feedback animation */
@keyframes touch-ripple {
  0% {
    transform: scale(0);
    opacity: 0.5;
  }
  100% {
    transform: scale(2);
    opacity: 0;
  }
}

.touch-ripple {
  position: relative;
  overflow: hidden;
}

.touch-ripple::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  transform: translate(-50%, -50%) scale(0);
  pointer-events: none;
}

.touch-ripple:active::after {
  animation: touch-ripple 0.4s ease-out;
}

/* Mobile bottom navigation bar */
.mobile-nav {
  @apply fixed bottom-0 left-0 right-0 z-50;
  @apply bg-black/90 backdrop-blur-lg border-t border-white/10;
  @apply flex items-center justify-around;
  padding-bottom: env(safe-area-inset-bottom, 0);
}

.mobile-nav-item {
  @apply flex flex-col items-center justify-center;
  @apply min-w-[64px] min-h-[56px] p-2;
  @apply text-white/60 text-xs;
  @apply transition-colors duration-150;
}

.mobile-nav-item:active,
.mobile-nav-item[data-active='true'] {
  @apply text-cyan-400;
}

.mobile-nav-item svg {
  @apply size-6 mb-1;
}

/* Offline indicator */
.offline-indicator {
  @apply fixed top-0 left-0 right-0 z-[100];
  @apply bg-amber-600 text-white text-center py-2 text-sm font-medium;
  @apply transform -translate-y-full transition-transform duration-300;
}

.offline-indicator.visible {
  @apply translate-y-0;
}

/* Install prompt banner */
.install-banner {
  @apply fixed bottom-0 left-0 right-0 z-50;
  @apply bg-gradient-to-r from-cyan-900/95 to-blue-900/95 backdrop-blur-lg;
  @apply border-t border-cyan-400/30;
  @apply p-4 flex items-center justify-between gap-4;
  @apply transform translate-y-full transition-transform duration-300;
  padding-bottom: max(1rem, env(safe-area-inset-bottom));
}

.install-banner.visible {
  @apply translate-y-0;
}

.install-banner-content {
  @apply flex-1 min-w-0;
}

.install-banner-title {
  @apply text-white font-semibold truncate;
}

.install-banner-text {
  @apply text-white/70 text-sm truncate;
}

.install-banner-actions {
  @apply flex items-center gap-2 shrink-0;
}

/* Loading skeleton for mobile */
.skeleton {
  @apply bg-white/10 rounded animate-pulse;
}

.skeleton-text {
  @apply h-4 rounded;
}

.skeleton-circle {
  @apply rounded-full;
}

/* Swipe gesture indicator */
.swipe-indicator {
  @apply fixed bottom-20 left-1/2 -translate-x-1/2;
  @apply bg-white/20 backdrop-blur-sm rounded-full px-4 py-2;
  @apply text-white/80 text-sm font-medium;
  @apply opacity-0 transition-opacity duration-300;
  @apply pointer-events-none;
}

.swipe-indicator.visible {
  @apply opacity-100;
}

/* Performance mode indicator */
.perf-mode-badge {
  @apply fixed top-2 right-2 z-50;
  @apply bg-amber-500/20 border border-amber-400/40 rounded-full;
  @apply px-2 py-1 text-xs text-amber-200 font-mono;
}

/* Data saver mode styles */
.data-saver .ui-panel {
  @apply backdrop-blur-none bg-black/80;
}

.data-saver .hud-backdrop,
.data-saver .hud-dialog,
.data-saver .hud-toast {
  animation: none !important;
}
